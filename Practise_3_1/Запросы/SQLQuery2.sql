select pp.partner_name, iif(sum(p.minimum_cost_for_partner * pp.products_amount) < 10000, 0, iif(SUM(p.minimum_cost_for_partner * pp.products_amount) < 50000, 5, iif(SUM(p.minimum_cost_for_partner * pp.products_amount) < 300000, 10, 15))) * 0.01 * sum(p.minimum_cost_for_partner * pp.products_amount) as ResultDiscount from Partner_products pp join Products p on pp.products_id = p.products_id group by pp.partner_name